import { useState, useEffect, useRef } from "react"
import { AnimatePresence } from "framer-motion"
import { gsap } from "gsap"

const LoadingScreen = ({ onComplete }) => {
    const [isComplete, setIsComplete] = useState(false)
    const containerRef = useRef(null)
    const tireRef = useRef(null)
    const logoRef = useRef(null)
    const progressBarRef = useRef(null)
    const progressFillRef = useRef(null)
    const textRef = useRef(null)

    useEffect(() => {
        const tl = gsap.timeline()

        // Initial setup
        gsap.set(tireRef.current, {
            x: -300,
            rotation: 0,
            scale: 0.8
        })

        gsap.set([logoRef.current, progressBarRef.current, textRef.current], {
            opacity: 0,
            y: 30
        })

        gsap.set(progressFillRef.current, {
            scaleX: 0,
            transformOrigin: "left center"
        })

        // Animation sequence
        tl
            // 1. Roll in from left with bounce
            .to(tireRef.current, {
                x: 0,
                rotation: 1080, // 3 full rotations
                scale: 1,
                duration: 2.2,
                ease: "back.out(1.2)",
            })
            
            // 2. Show logo and text
            .to(logoRef.current, {
                opacity: 1,
                y: 0,
                duration: 0.8,
                ease: "power3.out"
            }, "-=1.2")
            
            .to(textRef.current, {
                opacity: 1,
                y: 0,
                duration: 0.6,
                ease: "power2.out"
            }, "-=0.4")

            // 3. Show progress bar
            .to(progressBarRef.current, {
                opacity: 1,
                y: 0,
                duration: 0.5,
                ease: "power2.out"
            }, "-=0.3")

            // 4. Fill progress bar while tire keeps rotating
            .to(progressFillRef.current, {
                scaleX: 1,
                duration: 1.5,
                ease: "power2.inOut"
            }, "-=0.2")

            .to(tireRef.current, {
                rotation: "+=540", // Keep rotating
                duration: 1.5,
                ease: "none"
            }, "-=1.5")

            // 5. Final tire acceleration and exit
            .to(tireRef.current, {
                x: 400,
                rotation: "+=1440", // 4 more rotations while exiting
                scale: 1.2,
                duration: 1.8,
                ease: "power3.in",
            })

            // 6. Fade everything out
            .to([logoRef.current, progressBarRef.current, textRef.current], {
                opacity: 0,
                y: -20,
                duration: 0.6,
                ease: "power2.in"
            }, "-=1.2")

            .to(containerRef.current, {
                opacity: 0,
                duration: 0.8,
                ease: "power2.inOut",
                onComplete: () => {
                    setIsComplete(true)
                    onComplete()
                },
            }, "-=0.4")

        return () => tl.kill()
    }, [onComplete])

    return (
        <AnimatePresence>
            {!isComplete && (
                <div
                    ref={containerRef}
                    className="fixed inset-0 z-[9999] bg-gradient-to-br from-blue-50 to-white flex flex-col items-center justify-center overflow-hidden"
                >
                    {/* Rolling tire */}
                    <div ref={tireRef} className="mb-8">
                        <svg
                            width="100"
                            height="100"
                            viewBox="0 0 186 181"
                            fill="none"
                            xmlns="http://www.w3.org/2000/svg"
                            className="w-24 h-24 drop-shadow-lg"
                        >
                            <ellipse cx="93" cy="92.5" rx="93" ry="88.5" fill="white" />
                            <path
                                d="M64.7075 35.2801C65.3999 35.0006 66.1051 34.7323 66.8231 34.4751L69.035 33.7205C79.5686 30.3273 93.4745 28.8123 116.991 33.9385C127.499 36.2304 135.391 43.3523 140.507 51.3797C146.931 61.4644 150.701 75.0149 150.701 89.6722C150.701 104.335 146.931 117.88 140.507 127.965C135.384 135.992 127.492 143.114 116.991 145.406C93.4745 150.532 79.5686 149.017 69.035 145.63L66.8296 144.869C66.1194 144.613 65.4141 144.346 64.7139 144.07C55.7574 140.531 48.4423 133.035 43.4159 123.733C38.3318 114.325 35.2993 102.58 35.2993 89.6722C35.2993 76.7646 38.3318 65.0197 43.4159 55.6115C48.4423 46.3095 55.751 38.8131 64.7075 35.2801ZM112.234 44.9511C106.765 44.9511 100.469 48.4952 95.1734 56.8134C89.9868 64.9414 86.5889 76.5466 86.5889 89.6722C86.5889 102.798 89.9868 114.403 95.1734 122.531C100.469 130.849 106.765 134.393 112.234 134.393C117.702 134.393 123.998 130.849 129.294 122.531C134.48 114.403 137.878 102.798 137.878 89.6722C137.878 76.5466 134.48 64.9414 129.294 56.8134C123.998 48.4952 117.702 44.9511 112.234 44.9511ZM112.234 70.1067C116.76 70.1067 119.991 73.2316 121.902 76.5633C123.908 80.0628 125.056 84.7026 125.056 89.6722C125.056 94.6419 123.902 99.2817 121.902 102.781C119.991 106.113 116.76 109.238 112.234 109.238C107.707 109.238 104.476 106.113 102.566 102.781C100.565 99.2817 99.4112 94.6419 99.4112 89.6722C99.4112 84.7026 100.565 80.0628 102.566 76.5633C104.476 73.2372 107.707 70.1067 112.234 70.1067Z"
                                fill="#2563EB"
                            />
                        </svg>
                    </div>

                    {/* LlantaTech Logo */}
                    <div ref={logoRef} className="mb-6">
                        <svg width="200" height="60" viewBox="0 0 819 189" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path
                                d="M68.4998 114L78.0248 13.05H100.225L92.5748 92.4H126.475L124.525 114H68.4998ZM139.545 114L149.07 13.05H171.27L163.62 92.4H197.52L195.57 114H139.545ZM232.265 116.625C226.165 116.625 221.065 115.5 216.965 113.25C212.915 110.95 209.965 107.875 208.115 104.025C206.265 100.175 205.59 95.925 206.09 91.275C206.39 86.825 207.765 83 210.215 79.8C212.665 76.6 216.14 74.125 220.64 72.375C225.14 70.625 230.59 69.75 236.99 69.75C240.29 69.75 243.215 69.95 245.765 70.35C248.365 70.7 250.99 71.05 253.64 71.4L254.165 66.525C254.565 63.025 254.265 60.275 253.265 58.275C252.315 56.275 249.99 55.275 246.29 55.275C243.94 55.275 241.99 55.675 240.44 56.475C238.94 57.225 237.765 58.225 236.915 59.475C236.115 60.675 235.59 62 235.34 63.45H211.265C211.815 57.45 213.615 52.55 216.665 48.75C219.765 44.9 223.84 42.075 228.89 40.275C233.99 38.425 239.79 37.5 246.29 37.5C257.54 37.5 265.615 40.075 270.515 45.225C275.465 50.325 277.49 57.75 276.59 67.5L272.24 114H252.815C252.665 112.8 252.54 111.575 252.44 110.325C252.34 109.075 252.19 107.825 251.99 106.575C249.34 109.775 246.69 112.25 244.04 114C241.39 115.75 237.465 116.625 232.265 116.625ZM239.84 97.95C242.34 97.95 244.365 97.425 245.915 96.375C247.465 95.325 248.715 93.975 249.665 92.325C250.665 90.675 251.515 88.95 252.215 87.15C250.765 86.75 248.915 86.375 246.665 86.025C244.415 85.625 242.34 85.425 240.44 85.425C237.64 85.425 235.19 85.925 233.09 86.925C231.04 87.925 229.965 89.375 229.865 91.275C229.765 93.325 230.765 94.95 232.865 96.15C234.965 97.35 237.29 97.95 239.84 97.95ZM293.725 114L300.775 39.675H320.125L321.325 50.325C324.225 45.875 327.45 42.625 331 40.575C334.6 38.525 338.375 37.5 342.325 37.5C348.075 37.5 352.625 38.95 355.975 41.85C359.325 44.7 361.625 48.65 362.875 53.7C364.125 58.7 364.475 64.425 363.925 70.875L360.025 114H337.3L341.2 70.875C341.7 67.225 341.25 64.5 339.85 62.7C338.5 60.85 336.65 59.925 334.3 59.925C330.85 59.925 327.6 61.675 324.55 65.175C321.5 68.675 319.55 74.65 318.7 83.1L315.925 114H293.725ZM404.954 116.625C400.754 116.625 396.904 115.75 393.404 114C389.904 112.2 387.204 109.475 385.304 105.825C383.454 102.175 382.779 97.5 383.279 91.8L387.029 51.525L390.104 55.5H379.154L380.579 39.675H391.829L388.154 43.05L390.029 21.375H412.229L410.354 43.05L407.279 39.675H425.579L424.079 55.5H405.704L409.379 51.525L405.854 90.675C405.654 93.025 405.979 94.725 406.829 95.775C407.729 96.775 409.304 97.275 411.554 97.275C412.404 97.275 413.504 97.125 414.854 96.825C416.204 96.525 417.879 96 419.879 95.25L421.604 112.575C418.854 113.575 416.179 114.5 413.579 115.35C411.029 116.2 408.154 116.625 404.954 116.625ZM458.876 116.625C452.776 116.625 447.676 115.5 443.576 113.25C439.526 110.95 436.576 107.875 434.726 104.025C432.876 100.175 432.201 95.925 432.701 91.275C433.001 86.825 434.376 83 436.826 79.8C439.276 76.6 442.751 74.125 447.251 72.375C451.751 70.625 457.201 69.75 463.601 69.75C466.901 69.75 469.826 69.95 472.376 70.35C474.976 70.7 477.601 71.05 480.251 71.4L480.776 66.525C481.176 63.025 480.876 60.275 479.876 58.275C478.926 56.275 476.601 55.275 472.901 55.275C470.551 55.275 468.601 55.675 467.051 56.475C465.551 57.225 464.376 58.225 463.526 59.475C462.726 60.675 462.201 62 461.951 63.45H437.876C438.426 57.45 440.226 52.55 443.276 48.75C446.376 44.9 450.451 42.075 455.501 40.275C460.601 38.425 466.401 37.5 472.901 37.5C484.151 37.5 492.226 40.075 497.126 45.225C502.076 50.325 504.101 57.75 503.201 67.5L498.851 114H479.426C479.276 112.8 479.151 111.575 479.051 110.325C478.951 109.075 478.801 107.825 478.601 106.575C475.951 109.775 473.301 112.25 470.651 114C468.001 115.75 464.076 116.625 458.876 116.625ZM466.451 97.95C468.951 97.95 470.976 97.425 472.526 96.375C474.076 95.325 475.326 93.975 476.276 92.325C477.276 90.675 478.126 88.95 478.826 87.15C477.376 86.75 475.526 86.375 473.276 86.025C471.026 85.625 468.951 85.425 467.051 85.425C464.251 85.425 461.801 85.925 459.701 86.925C457.651 87.925 456.576 89.375 456.476 91.275C456.376 93.325 457.376 94.95 459.476 96.15C461.576 97.35 463.901 97.95 466.451 97.95ZM523.924 114L531.724 34.425H505.174L507.199 13.05H582.424L580.399 34.425H553.924L546.124 114H523.924ZM601.75 116.625C596.05 116.625 590.875 114.925 586.225 111.525C581.575 108.075 577.975 103.35 575.425 97.35C572.925 91.3 572.05 84.4 572.8 76.65C573.55 68.45 575.725 61.45 579.325 55.65C582.975 49.8 587.425 45.325 592.675 42.225C597.925 39.075 603.425 37.5 609.175 37.5C614.675 37.5 619.275 38.675 622.975 41.025C626.675 43.325 629.575 46.425 631.675 50.325C633.775 54.225 635.15 58.6 635.8 63.45C636.45 68.25 636.425 73.15 635.725 78.15C635.475 79.2 635.225 80.1 634.975 80.85C634.775 81.6 634.575 82.425 634.375 83.325H590.65L594.325 80.175C593.725 83.475 593.675 86.375 594.175 88.875C594.725 91.375 595.775 93.325 597.325 94.725C598.925 96.125 601 96.825 603.55 96.825C605.2 96.825 606.75 96.4 608.2 95.55C609.7 94.65 610.825 93.25 611.575 91.35H633.775C632.725 95.95 630.7 100.175 627.7 104.025C624.75 107.825 621.05 110.875 616.6 113.175C612.2 115.475 607.25 116.625 601.75 116.625ZM595.225 71.7L592.075 68.475H619.15L615.475 71.7C615.825 69.45 615.875 67.225 615.625 65.025C615.425 62.775 614.675 60.925 613.375 59.475C612.125 57.975 610.125 57.225 607.375 57.225C605.175 57.225 603.2 57.8 601.45 58.95C599.7 60.1 598.275 61.775 597.175 63.975C596.125 66.125 595.475 68.7 595.225 71.7ZM675.796 116.625C670.146 116.625 664.971 114.975 660.271 111.675C655.621 108.325 652.046 103.675 649.546 97.725C647.046 91.775 646.171 84.875 646.921 77.025C647.671 68.375 649.846 61.125 653.446 55.275C657.096 49.425 661.571 45 666.871 42C672.171 39 677.696 37.5 683.446 37.5C688.446 37.5 692.696 38.45 696.196 40.35C699.746 42.25 702.596 44.75 704.746 47.85C706.946 50.9 708.471 54.25 709.321 57.9C710.221 61.55 710.521 65.1 710.221 68.55L687.571 68.325C687.471 66.325 686.996 64.425 686.146 62.625C685.296 60.825 683.621 59.925 681.121 59.925C679.521 59.925 677.871 60.425 676.171 61.425C674.471 62.425 672.971 64.175 671.671 66.675C670.421 69.125 669.571 72.575 669.121 77.025C668.721 81.375 668.896 84.775 669.646 87.225C670.446 89.675 671.571 91.4 673.021 92.4C674.471 93.4 675.946 93.9 677.446 93.9C680.696 93.9 682.896 93.125 684.046 91.575C685.196 90.025 685.971 88.125 686.371 85.875H708.496C707.946 91.225 706.396 96.25 703.846 100.95C701.296 105.6 697.696 109.375 693.046 112.275C688.396 115.175 682.646 116.625 675.796 116.625ZM722.992 114L732.592 10.2H755.167L751.267 49.575C754.167 45.275 757.342 42.2 760.792 40.35C764.292 38.45 767.917 37.5 771.667 37.5C777.417 37.5 781.967 38.95 785.317 41.85C788.667 44.7 790.942 48.65 792.142 53.7C793.392 58.7 793.742 64.425 793.192 70.875L789.292 114H766.642L770.542 70.875C771.042 67.175 770.592 64.425 769.192 62.625C767.792 60.825 765.917 59.925 763.567 59.925C761.867 59.925 760.067 60.375 758.167 61.275C756.317 62.125 754.567 63.65 752.917 65.85C751.317 68.05 750.017 71.15 749.017 75.15L745.192 114H722.992Z"
                                fill="#2563EB"
                            />
                            <path d="M64 172.5V138.5H756.5L64 172.5Z" fill="#2563EB" stroke="#2563EB"/>
                        </svg>
                    </div>

                    {/* Progress Bar */}
                    <div ref={progressBarRef} className="w-80 h-2 bg-gray-200 rounded-full overflow-hidden mb-4">
                        <div
                            ref={progressFillRef}
                            className="h-full bg-gradient-to-r from-blue-500 to-blue-600 rounded-full"
                        ></div>
                    </div>

                    {/* Loading Text */}
                    <p ref={textRef} className="text-gray-600 text-lg font-medium">
                        Preparando tu experiencia...
                    </p>
                </div>
            )}
        </AnimatePresence>
    )
}

export default LoadingScreen